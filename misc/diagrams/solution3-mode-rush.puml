@startuml Solution 3 - Mode Rush
title Solution 3 - Mode Rush avec Backend Modifié

participant "Utilisateur" as User
participant "App" as FE
participant "Menu Service\n:3000" as Menu
participant "Dining Service\n:3001" as Dining

note over FE: === FRONTEND ===
note over Menu,Dining: === BACKEND ===

== Détection Affluence (Temps Réel) ==

User -> FE: Ouvre l'application
activate FE

loop Toutes les 10 secondes
  FE -> Menu: **GET /rush-status**
  activate Menu
  
  Menu -> Dining: **GET /tableOrders**
  activate Dining
  Dining --> Menu: TableOrder[]
  deactivate Dining

  Menu -> Menu: count = filter(billed === null).length
  note right: Seuil configurable\n(par défaut: 10)
  
  alt count > threshold
    Menu --> FE: { isRushMode: true, activeOrders: count }
    FE --> User: Bannière + Toggle "Plats rapides"
  else count <= threshold
    Menu --> FE: { isRushMode: false }
    FE --> User: Masque bannière/toggle
  end
  deactivate Menu
end

== Filtrage Plats Rapides (si utilisateur active) ==

User -> FE: Active toggle "Plats rapides"
activate FE

FE -> Menu: **GET /menus?isQuick=true**
activate Menu

note right of Menu: Données du backend :\n- isQuick calculé: prepTime <= 15\n- prepTime validé en base\n- Pas d'estimation

Menu --> FE: MenuItem[] (isQuick=true, prepTime<=15)
deactivate Menu

FE --> User: Affiche plats rapides uniquement
note left of FE: Interface simplifiée\navec temps de prep affichés

deactivate FE

@enduml
